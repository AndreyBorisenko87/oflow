# Scalping Strategy — контекст

Цель: построение скальперской стратегии на ETHUSDT.  
Данные: тиковые и стаканные (Binance, Bybit, OKX).  
Задачи: поиск паттернов (stop-run, absorption, spoofing и др.).  

## 🏗️ АРХИТЕКТУРА БЛОКОВ

### ✅ **ВСЕ БЛОКИ ЗАВЕРШЕНЫ (100%)**

#### **Блок 01: Конфиг** ✅
- `configs/config.yaml` - основные настройки проекта
- `configs/sources.yaml` - пути к данным по биржам
- **Статус**: Полностью реализован с расширенными настройками

#### **Блок 02: Импорт сырья** ✅
- `src/oflow/blocks/import_raw.py` - импорт parquet файлов
- **Статус**: Полностью функционален, работает с 3 биржами

#### **Блок 03: Нормализация** ✅
- `src/oflow/blocks/normalization.py` - нормализация в единый формат
- `configs/normalization.yaml` - конфигурация нормализации
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 04: Синхронизация времени** ✅
- `src/oflow/blocks/sync_time.py` - оценка лагов, синхронизация, фильтрация дропов
- `configs/sync_time.yaml` - конфигурация синхронизации
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 05: Лучшие цены** ✅
- `src/oflow/blocks/best_prices.py` - восстановление best bid/ask/mid, расчет спредов
- `configs/best_prices.yaml` - конфигурация восстановления цен
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 06: Топ-зона книги** ✅
- `src/oflow/blocks/book_top.py` - анализ топ-уровней order book, отслеживание изменений
- `configs/book_top.yaml` - конфигурация анализа order book
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 07: Лента сделок** ✅
- `src/oflow/blocks/trade_tape.py` - анализ агрессии, объемы по окнам, квантили
- `configs/trade_tape.yaml` - конфигурация анализа
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 08: Кросс-биржевая агрегация** ✅
- `src/oflow/blocks/cross_exchange.py` - NBBO, суммарные объемы, синхронизация
- `configs/cross_exchange.yaml` - конфигурация агрегации
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 09: Базис спот-фьючерс** ✅
- `src/oflow/blocks/basis.py` - разница спот-фьючерс, аномалии, категоризация
- `configs/basis.yaml` - конфигурация анализа базиса
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 10: Фичи паттернов** ✅
- `src/oflow/blocks/features.py` - извлечение признаков для 8 детекторов (D1-D8)
- `configs/features.yaml` - конфигурация извлечения фич
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 11: Канонический слой** ✅
- `src/oflow/blocks/canonical.py` - пакетное сохранение данных по дням с индексацией
- `configs/canonical.yaml` - конфигурация канонического слоя
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 12: Детекторы** ✅
- `src/oflow/blocks/detectors.py` - основной модуль детекторов
- `src/oflow/blocks/detectors/` - пакет с 8 детекторами паттернов
- `configs/detectors.yaml` - конфигурация всех детекторов
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 13: Сканер** ✅
- `src/oflow/blocks/scanner.py` - автоматическое сканирование и обработка данных
- `configs/scanner.yaml` - конфигурация сканера
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 14: Бэктест** ✅
- `src/oflow/blocks/backtest.py` - полная реализация торговых стратегий с управлением рисками
- `configs/backtest.yaml` - конфигурация стратегий и управления рисками
- **Статус**: Полностью реализован с прогресс-логированием

#### **Блок 15: Экспорт разметки** ✅
- `src/oflow/blocks/export.py` - полная реализация экспорта для TradingView и ATAS
- `configs/export.yaml` - конфигурация экспорта и форматирования
- **Статус**: Полностью реализован с прогресс-логированием

## 📁 **СТРУКТУРА ПРОЕКТА**

```
oflow/
├── configs/                  # Конфигурационные файлы (15 файлов)
├── src/oflow/blocks/         # Все 15 блоков обработки
├── data/                     # Выходные данные
├── logs/                     # Логи
├── tests/                    # Тесты
├── docs/                     # Документация
│   ├── context.md            # Этот файл
│   └── blocks/               # README для каждого блока (15 файлов)
└── scripts/                  # Вспомогательные скрипты
```

## 🎯 **КЛЮЧЕВЫЕ ОСОБЕННОСТИ**

### **1. Прогресс-логирование**
Все блоки включают поэтапное логирование прогресса выполнения с настраиваемыми флагами `log_progress`.

### **2. Конфигурация**
Каждый блок имеет собственный YAML файл конфигурации с детальными параметрами.

### **3. Документация**
Каждый блок имеет подробную документацию в `docs/blocks/README_*.md`.

### **4. Тестирование**
Все блоки протестированы на синтетических данных с валидацией функциональности.

## 🚀 **ИСПОЛЬЗОВАНИЕ**

### **Запуск полной цепочки**:
```python
from src.oflow.pipeline import run_pipeline
result = run_pipeline(config)
```

### **Запуск отдельного блока**:
```python
from src.oflow.blocks import run_normalization, run_time_sync

# Блок 03: Нормализация
normalized_trades, normalized_depth = run_normalization(trades_df, depth_df, config)

# Блок 04: Синхронизация времени
synced_trades, synced_depth = run_time_sync(normalized_trades, normalized_depth, config)
```

## 📊 **ДЕТЕКТОРЫ ПАТТЕРНОВ (D1-D8)**

1. **D1**: Scalping Strategy - вакуум ликвидности
2. **D2**: Stop Run Detection - обнаружение stop-run
3. **D3**: Iceberg Fade - затухание iceberg ордеров
4. **D4**: Absorption Pattern - паттерн поглощения
5. **D5**: Spoofing Detection - обнаружение спуфинга
6. **D6**: Momentum Shift - сдвиг импульса
7. **D7**: Volume Anomaly - аномалии объема
8. **D8**: Price Rejection - отторжение цены

## 🔧 **ТЕХНИЧЕСКИЕ ДЕТАЛИ**

- **Форматы**: Parquet (вход/выход), CSV (экспорт)
- **Сжатие**: Snappy
- **Временные метки**: Наносекунды (int64)
- **Синхронизация**: UTC, оценка лагов между биржами
- **Биржи**: Binance, Bybit, OKX
- **Рынки**: Spot, Futures
- **Инструменты**: ETHUSDT (основной)

---

**Статус**: ✅ Завершен (100% готово)  
**Версия**: 1.0.0  
**Последнее обновление**: Август 2025
