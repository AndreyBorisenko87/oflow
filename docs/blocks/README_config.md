# Блок 01: Конфигурация

## Обзор
Блок "Конфигурация" является центральным элементом системы, содержащим все настройки для работы всех остальных блоков. Он обеспечивает гибкость и настраиваемость системы под различные требования и окружения.

## Назначение
- **Централизованное управление**: Все настройки в одном месте
- **Гибкость конфигурации**: Адаптация под различные сценарии
- **Валидация параметров**: Проверка корректности настроек
- **Управление окружениями**: Разные конфигурации для dev/test/prod
- **Документирование**: Описание всех параметров системы

## Ключевые возможности

### 1. Настройки символов и инструментов
- Основные торговые пары (ETHUSDT)
- Спотовые и фьючерсные рынки
- Дополнительные символы для анализа
- Расширяемость для новых инструментов

### 2. Конфигурация бирж
- Список поддерживаемых бирж
- Настройки для каждой биржи
- Потенциальные биржи для будущего
- Адаптация под специфику источников

### 3. Временные параметры
- Часовые пояса и синхронизация
- Размеры временных окон анализа
- Частота обновления данных
- Политики хранения данных

### 4. Настройки анализа
- Параметры order book
- Окна анализа паттернов
- Пороги для детекторов
- Метрики качества

### 5. Производительность и мониторинг
- Параллельная обработка
- Управление памятью
- Кэширование
- Мониторинг здоровья системы

## Архитектура

### Основные секции
- `symbols` - Торговые инструменты
- `exchanges` - Поддерживаемые биржи
- `markets` - Типы рынков
- `time` - Временные настройки
- `orderbook` - Параметры книги заявок
- `windows` - Временные окна анализа
- `sync` - Настройки синхронизации
- `patterns` - Конфигурация паттернов
- `detectors` - Настройки детекторов
- `export` - Параметры экспорта
- `performance` - Настройки производительности
- `logging` - Конфигурация логирования
- `monitoring` - Параметры мониторинга
- `security` - Настройки безопасности
- `development` - Параметры разработки

### Иерархия конфигурации
```
config.yaml (основной файл)
├── sources.yaml (пути к данным)
├── sync_time.yaml (синхронизация)
├── best_prices.yaml (лучшие цены)
├── normalization.yaml (нормализация)
├── book_top.yaml (топ-зона)
├── trade_tape.yaml (лента сделок)
├── cross_exchange.yaml (агрегация)
├── basis.yaml (базис)
├── features.yaml (фичи)
├── canonical.yaml (канонический слой)
├── detectors.yaml (детекторы)
├── scanner.yaml (сканер)
├── backtest.yaml (бэктест)
└── export.yaml (экспорт)
```

## Использование

### Базовый пример
```python
import yaml
from pathlib import Path

# Загрузка основной конфигурации
with open('configs/config.yaml', 'r') as f:
    config = yaml.safe_load(f)

# Загрузка специфичной конфигурации
with open('configs/sync_time.yaml', 'r') as f:
    sync_config = yaml.safe_load(f)

# Объединение конфигураций
full_config = {**config, **sync_config}

# Использование параметров
tick_size = config['time']['tick_size_ms']
exchanges = config['exchanges']
```

### Конфигурация по умолчанию
```yaml
# Основные настройки
symbols:
  primary: "ETHUSDT"
  spot: ["ETHUSDT"]
  futures: ["ETHUSDT-PERP"]

exchanges:
  - "binance"
  - "bybit"
  - "okx"

time:
  timezone: "UTC"
  tick_size_ms: 10
```

## Структура данных

### Входные данные
- YAML файлы конфигурации
- Переменные окружения
- Аргументы командной строки

### Выходные данные
- Словарь конфигурации
- Валидированные параметры
- Настройки по умолчанию

## Валидация конфигурации

### 1. Проверка обязательных полей
- Наличие критических секций
- Корректность типов данных
- Диапазоны допустимых значений

### 2. Проверка зависимостей
- Совместимость параметров
- Корректность ссылок между секциями
- Валидность путей к файлам

### 3. Проверка окружения
- Доступность API ключей
- Существование директорий
- Права доступа к файлам

## Управление окружениями

### Разработка (Development)
```yaml
development:
  debug_mode: true
  test_data_enabled: true
  development_logging: true
  mock_exchanges: true
```

### Тестирование (Testing)
```yaml
development:
  debug_mode: false
  test_data_enabled: true
  development_logging: false
  mock_exchanges: false
```

### Продакшн (Production)
```yaml
development:
  debug_mode: false
  test_data_enabled: false
  development_logging: false
  mock_exchanges: false
```

## Безопасность

### 1. Шифрование
- API ключи в зашифрованном виде
- Конфиденциальные данные защищены
- Безопасное хранение паролей

### 2. Доступ
- Логирование всех обращений
- Ограничение скорости запросов
- Контроль доступа к файлам

### 3. Аудит
- История изменений конфигурации
- Отслеживание модификаций
- Резервное копирование

## Производительность

### 1. Оптимизации
- Кэширование конфигурации
- Ленивая загрузка секций
- Минимизация I/O операций

### 2. Мониторинг
- Время загрузки конфигурации
- Использование памяти
- Производительность валидации

### 3. Масштабирование
- Поддержка больших конфигураций
- Параллельная обработка
- Распределенные настройки

## Логирование

### Уровни логирования
- **DEBUG**: Детальная информация о загрузке
- **INFO**: Основные операции с конфигурацией
- **WARNING**: Проблемы с параметрами
- **ERROR**: Критические ошибки валидации

### Типы логов
- Загрузка конфигурации
- Валидация параметров
- Изменения настроек
- Ошибки конфигурации

## Интеграция

### Входные блоки
- Все блоки используют конфигурацию

### Выходные блоки
- Все блоки получают настройки

### Взаимодействие
- Централизованное управление
- Единообразный доступ к параметрам
- Консистентность настроек

## Устранение неполадок

### Частые проблемы
1. **Отсутствующие секции**: Проверить структуру YAML
2. **Некорректные типы**: Убедиться в правильности типов данных
3. **Невалидные значения**: Проверить диапазоны параметров

### Отладка
- Включить детальное логирование
- Проверить синтаксис YAML
- Валидировать конфигурацию

## Будущие улучшения

### Планируемые функции
- Веб-интерфейс для конфигурации
- Автоматическая валидация
- Шаблоны конфигураций
- Версионирование настроек

### Оптимизации
- Кэширование в Redis
- Горячая перезагрузка
- Автоматическое резервное копирование
- Интеграция с системами управления конфигурацией
